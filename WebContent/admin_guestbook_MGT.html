<!DOCTYPE html>
<html lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>留言板管理界面 - 超市会员管理系统</title>
<link rel="icon" href="favicon.ico" type="image/ico">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/materialdesignicons.min.css" rel="stylesheet">
<link href="css/style.min.css" rel="stylesheet">
<link href="css/layer.css" rel="stylesheet">
<style>
/* 最外框外框 无滚动条 */
.div-out-height {
  border: 1px solid #eee;
  border-radius: 3px;
  /*background-color: #fff;*/
  position: relative;
  overflow: hidden;
  /*height: calc(100% - 65px);*/
}
/* 假表头 */
.false_table{
    width: 100%;
    float: left;
}
/* 假表头宽度为（100% - 滚动条宽度）*/
.false_table table{
    margin: 0;
    width: calc(100% - 19px);
    table-layout: fixed;
}
/* 表格滚动条 */
.out_scoll {
  overflow: scroll;
  overflow-x: hidden;
  clear: both;
  max-height: 400px;  /* 给有滚动条的框加最大高度，超过这个高度就开始滚动 */
}
/* 隐藏真表头 */
.out_scoll thead{
  display: none!important;
}	

.th1,.td1{
	width: 40px;
}

.th2,.td2{
	width: 200px;
	white-space:nowrap;
	overflow:hidden;
	text-overflow: ellipsis;
}

.th3,.td3{
	width: 100px;
}

.th4,.td4{
	width: 100px;
}

.th5,.td5{
	width: 70px;
}

.th6,.td6{
	width: 100px;
}
</style>
</head>
  
<body>
<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <!--左侧导航-->
    <aside class="lyear-layout-sidebar">
      
      <!-- logo -->
      <div id="logo" class="sidebar-header">
        <a href="admin_homepage.html"><img src="images/logo-sidebar.png" title="shop_member_MGT" alt="logo" /></a>
      </div>
      <div class="lyear-layout-sidebar-scroll"> 
        
        <nav class="sidebar-main">
          <ul class="nav nav-drawer">
            <li class="nav-item"> <a href="admin_homepage.html"><i class="mdi mdi-home"></i> 后台首页</a> </li>
            <li class="nav-item"><a href="admin_user_MGT.html"><i class="mdi mdi-file-account"></i> 会员信息管理</a></li>
            <li class="nav-item"><a href="admin_card_MGT.html"><i class="mdi mdi-account-card-details"></i> 会员卡信息管理</a></li>
            <li class="nav-item nav-item-has-subnav">
            	<a href="javascript:void(0)"><i class="mdi mdi-shopping"></i> 商品管理</a>
            	<ul class="nav nav-subnav">
            		<li> <a href="admin_goods_add.html">商品增加</a> </li>
            		<li> <a href="admin_goods_in.html">商品入库</a> </li>
                <li> <a href="admin_goods_query.html">商品查看</a> </li>
              </ul>
            </li>
            <li class="nav-item active"><a href="admin_guestbook_MGT.html"><i class="mdi mdi-comment-text-outline"></i> 留言板管理</a></li>
          </ul>
        </nav>
        
        <div class="sidebar-footer">
          <p class="copyright">Copyright &copy; 2020.snow . All rights reserved. </p>
        </div>
      </div>
      
    </aside>
    <!--End 左侧导航-->
    
    <!--头部信息-->
    <header class="lyear-layout-header">
      
      <nav class="navbar navbar-default">
        <div class="topbar">
          
          <div class="topbar-left">
            <div class="lyear-aside-toggler">
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
              <span class="lyear-toggler-bar"></span>
            </div>
            <span class="navbar-page-title"> 留言板管理页面 </span>
          </div>
          
          <ul class="topbar-right">
            <li class="dropdown dropdown-profile">
              <a href="javascript:void(0)" data-toggle="dropdown">
                <img class="img-avatar img-avatar-48 m-r-10" src="images/users/avatar.jpg" alt="admin" />
                <span>admin <span class="caret"></span></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-right">
                <li> <a href="login.html"><i class="mdi mdi-logout-variant"></i> 退出登录</a> </li>
              </ul>
            </li>
            <!--切换主题配色-->
		    <li class="dropdown dropdown-skin">
			  <span data-toggle="dropdown" class="icon-palette"><i class="mdi mdi-palette"></i></span>
			  <ul class="dropdown-menu dropdown-menu-right" data-stopPropagation="true">
                <li class="drop-title"><p>主题</p></li>
                <li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="site_theme" value="default" id="site_theme_1" checked>
                    <label for="site_theme_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="site_theme" value="dark" id="site_theme_2">
                    <label for="site_theme_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="site_theme" value="translucent" id="site_theme_3">
                    <label for="site_theme_3"></label>
                  </span>
                </li>
			    <li class="drop-title"><p>LOGO</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="logo_bg" value="default" id="logo_bg_1" checked>
                    <label for="logo_bg_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_2" id="logo_bg_2">
                    <label for="logo_bg_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_3" id="logo_bg_3">
                    <label for="logo_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_4" id="logo_bg_4">
                    <label for="logo_bg_4"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_5" id="logo_bg_5">
                    <label for="logo_bg_5"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_6" id="logo_bg_6">
                    <label for="logo_bg_6"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_7" id="logo_bg_7">
                    <label for="logo_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="logo_bg" value="color_8" id="logo_bg_8">
                    <label for="logo_bg_8"></label>
                  </span>
				</li>
				<li class="drop-title"><p>头部</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="header_bg" value="default" id="header_bg_1" checked>
                    <label for="header_bg_1"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_2" id="header_bg_2">
                    <label for="header_bg_2"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_3" id="header_bg_3">
                    <label for="header_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="header_bg" value="color_4" id="header_bg_4">
                    <label for="header_bg_4"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_5" id="header_bg_5">
                    <label for="header_bg_5"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_6" id="header_bg_6">
                    <label for="header_bg_6"></label>                      
                  </span>                                                    
                  <span>                                                     
                    <input type="radio" name="header_bg" value="color_7" id="header_bg_7">
                    <label for="header_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="header_bg" value="color_8" id="header_bg_8">
                    <label for="header_bg_8"></label>
                  </span>
				</li>
				<li class="drop-title"><p>侧边栏</p></li>
				<li class="drop-skin-li clearfix">
                  <span class="inverse">
                    <input type="radio" name="sidebar_bg" value="default" id="sidebar_bg_1" checked>
                    <label for="sidebar_bg_1"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_2" id="sidebar_bg_2">
                    <label for="sidebar_bg_2"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_3" id="sidebar_bg_3">
                    <label for="sidebar_bg_3"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_4" id="sidebar_bg_4">
                    <label for="sidebar_bg_4"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_5" id="sidebar_bg_5">
                    <label for="sidebar_bg_5"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_6" id="sidebar_bg_6">
                    <label for="sidebar_bg_6"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_7" id="sidebar_bg_7">
                    <label for="sidebar_bg_7"></label>
                  </span>
                  <span>
                    <input type="radio" name="sidebar_bg" value="color_8" id="sidebar_bg_8">
                    <label for="sidebar_bg_8"></label>
                  </span>
				</li>
			  </ul>
			</li>
            <!--切换主题配色-->
          </ul>
          
        </div>
      </nav>
      
    </header>
    <!--End 头部信息-->
    
    <!--页面主要内容-->
    <main class="lyear-layout-content">
      
      <div class="container-fluid">
        
        <div class="row">
          
          <div class="col-lg-12">
            <div class="card">
              <div class="card-header">
                <h4>留言板管理</h4>
              </div>
              <div class="card-body" id="table-wrapper">
                <div class="table-responsive div-out-height" id="gbMGT-table">
                   <!-- 假表头 -->
									<div class="false_table">
										<table class="table">
											<thead>
												<tr class="tableTh">
													<th class="th1">留言ID</th>
	                        <th class="th2">留言内容</th>
	                        <th class="th3">用户名</th>
	                        <th class="th4">留言时间</th>
	                        <th class="th5">状态</th>
	                        <th class="th6">操作</th>
												</tr>
											</thead>
										</table>
									</div>
									<!-- 真表 -->
							    <div class="out_scoll">
							      <table class="table table-hover"  style="table-layout: fixed;">
							        <thead> 
							          <tr class="tableTh">
							            <th class="th1" style="width: 55px;">留言ID</th>
	                        <th class="th2">留言内容</th>
	                        <th class="th3">用户名</th>
	                        <th class="th4">留言时间</th>
	                        <th class="th5">状态</th>
	                        <th class="th6">操作</th>
							          </tr>
							        </thead>
							        <tbody id="show">
							        	
							          <!--
							          	留言板内容
							          -->
							        </tbody>
							      </table>
							      
							      <!--编辑的弹出框-->
							      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	                  <div class="modal-dialog" role="document">
	                    <div class="modal-content">
	                      <div class="modal-header">
	                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	                        <h4 class="modal-title">用户留言内容</h4> <br>
	                        <p class="list-group-item list-group-item-info"  id="comment" ></p>
	                        <input type="text" id="uid" hidden="hidden" >
	                        <input type="text" id="gbid" hidden="hidden" >
	                      </div>
	                      <div class="modal-body">
	                      	<h4 class="modal-title">请在以下填写留言内容</h4>
	                      	
	                        <textarea style="width: 100%; height: 200px;" id="replyContent"></textarea>
	                      </div>
	                      <div class="modal-footer">
	                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	                        <button type="button" class="btn btn-primary" onclick="addReply()">点击回复</button>
	                      </div>
	                    </div>
	                  </div>
	                </div>
	                
	                <!--查看回复的弹出框-->
							      <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	                  <div class="modal-dialog" role="document">
	                    <div class="modal-content">
	                      <div class="modal-header">
	                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	                        <h4 class="modal-title">用户留言内容</h4> <br>
	                        <p class="list-group-item list-group-item-info "  id="comment2" ></p>
	                        <input type="text" id="uid2"  hidden="hidden" >
	                        <input type="text" id="gbid2" hidden="hidden" >
	                      </div>
	                      <div class="modal-body">
	                      	<h4 class="modal-title">您回复的内容</h4>
	                      	<p class="list-group-item list-group-item-info" id="replyContent2"></p>
	                      </div>
	                      <div class="modal-footer">
	                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	                        <button type="button" class="btn btn-danger" onclick="deleteReply()">删除您的回复</button>
	                      </div>
	                    </div>
	                  </div>
	                </div>
	                
	                
	                
							    </div>
                 
                </div>
              </div>
            </div>
          </div>
          
        </div>
  
          
      </div>
      
    </main>
    <!--End 页面主要内容-->
  </div>
</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="js/main.min.js"></script>
<script type="text/javascript" src="js/layer.js"></script>
<script type="text/javascript">
$(document).ready(function(e) {
	$.post("guestbook/showAll",function(guestbooks){
		
		/*在表格内显示用户数据*/
	    var strlis = '';
	   
	    $.each($.parseJSON(guestbooks), function(i, guestbook) {
			str = '';
			str ='<tr class="tableTd">\n'+ 
			     '	<td class="td1">'+guestbook.gbID+'</td>\n'+
			     '	<td class="td2" data-toggle="tooltip" data-placement="bottom" title="'+guestbook.content+'">'+guestbook.content+'</td>\n'+
			     '	<td class="td3">'+guestbook.user.userName+'</td>\n'+
			     '	<td class="td4">'+guestbook.addtime+'</td>\n';
			if (guestbook.flag == 0) {
				str += '	<td class="td5"><span class="label label-warning">待回复</span></td>';
			} else{
				str += '	<td class="td5"><span class="label label-success">已回复</span></td>';
			}     
			str +='	<td class="td6">'+
					 '		<div class="btn-group">';
			if (guestbook.flag == 0) {
				str += '			<a class="btn btn-xs btn-default" title="编辑" onclick="getComment('+guestbook.gbID+')" data-toggle="modal" data-target="#myModal"><i class="mdi mdi-pencil"></i></a>\n';
			} else{
				str += '			<a class="btn btn-xs btn-default" title="查看您的回复" onclick="getReply('+guestbook.gbID+')" data-toggle="modal" data-target="#myModal2"><i class="mdi mdi-eye"></i></a>\n';
			}  
			     
			str +='			<a class="btn btn-xs btn-default" title="删除整条留言" data-toggle="tooltip"><i class="mdi mdi-window-close"></i></a>\n'+
			     '		</div>\n'+
			     '	</td>\n'+
			     '</tr>\n';
		
			 strlis += str; 			
		});
	    $("#show").html(strlis);
	});
});

//模态框1显示留言
function getComment(gbid){

	$.ajax({
				async:false,
				url:"guestbook/showOne",
				type:"post",
				dataType:"json",
				data: {gbid:gbid},
				success:function(guestbook){
					$("#comment").html(guestbook.content);
					$("#uid").val(guestbook.uID);
					$("#gbid").val(guestbook.gbID);
				}    
	});
}

//1管理员回复
function addReply(){
	$.ajax({
			async:false,
			url:"reply/addReply",
			type:"post",
			dataType:"json",
			data: {
				gbid:$('#gbid').val(),
				uid:$('#uid').val(),
				content:$('#replyContent').val()
			},
			success:function(result){
				//回复添加成功时	
				if (result) {
	  			layer.msg("回复添加成功!",{time:4000});
					window.location.reload();
	  			
	  		//回复添加失败时	
				}else{
					layer.msg("回复添加失败，请稍后重试",{time:3000});
					window.location.reload();
				}
		  }  
	});
}

//模态框2显示回复
function getReply(gbid){

	$.ajax({
				async:false,
				url:"reply/searchOne",
				type:"post",
				dataType:"json",
				data: {gbid:gbid},
				success:function(reply){
					console.log(reply);
					$("#comment2").html(reply.guestbook.content);
					$("#replyContent2").html(reply.content);
					$("#uid2").val(reply.uID);
					$("#gbid2").val(reply.gbID);
				}    
	});
}

//2删除回复点击事件
//function deleteReply() {
//	$.ajax({
//			async:false,
//			url:"reply/deleteReply",
//			type:"post",
//			dataType:"json",
//			data: {
//				gbid:$('#gbid2').val(),
//				uid:$('#uid2').val(),
//				content:$('#comment2').val()
//			},
//			success:function(result){
//				//回复删除成功时
//				if (result) {
//	  			layer.msg("回复信息删除成功!",{time:4000});
//					window.location.reload();
//	  			
//	  		//回复删除失败时	
//				}else{
//					layer.msg("回复信息删除失败，请稍后重试",{time:3000});
//					window.location.reload();
//				}
//		  }  
//	});
//}
</script>
</body>
</html>